{"ast":null,"code":"var _jsxFileName = \"C:\\\\vxxiv\\\\task-3\\\\src\\\\graphs\\\\versorDragging.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from \"react\";\nimport L from \"leaflet\";\nimport \"leaflet/dist/leaflet.css\";\nimport { geoPath, geoNaturalEarth1 } from \"d3-geo\";\nimport { select, pointers } from \"d3-selection\";\nimport { drag } from \"d3-drag\";\nimport { geoRotation, geoRotationIdentity } from \"d3-geo-projection\";\nimport { feature } from \"topojson-client\";\nimport land50mData from \"./land50m.json\";\nimport land110mData from \"./land110m.json\";\nimport d3 from 'd3-fetch';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Globe = () => {\n  _s();\n  const mapRef = useRef(null);\n  useEffect(() => {\n    const map = L.map(mapRef.current).setView([0, 0], 2);\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\").addTo(map);\n    const width = 800;\n    const height = 600;\n    const projection = geoNaturalEarth1().rotate([0, 0]).fitSize([width, height], {\n      type: \"Sphere\"\n    });\n    const context = select(map.getPane(\"overlayPane\")).append(\"canvas\").attr(\"width\", width).attr(\"height\", height).node().getContext(\"2d\");\n    const path = geoPath(projection, context);\n    const land50m = feature(land50mData, land50mData.objects.land);\n    const land110m = feature(land110mData, land110mData.objects.land);\n    function render(land) {\n      context.clearRect(0, 0, width, height);\n      context.beginPath();\n      path({\n        type: \"Sphere\"\n      });\n      context.fillStyle = \"#fff\";\n      context.fill();\n      context.beginPath();\n      path(land);\n      context.fillStyle = \"#000\";\n      context.fill();\n      context.beginPath();\n      path({\n        type: \"Sphere\"\n      });\n      context.stroke();\n    }\n    function pointer(event) {\n      const t = pointers(event);\n      if (t.length !== l) {\n        l = t.length;\n        if (l > 1) a0 = Math.atan2(t[1][1] - t[0][1], t[1][0] - t[0][0]);\n        dragstarted.apply(this, [event]);\n      }\n      if (l > 1) {\n        const x = d3.mean(t, p => p[0]);\n        const y = d3.mean(t, p => p[1]);\n        const a = Math.atan2(t[1][1] - t[0][1], t[1][0] - t[0][0]);\n        return [x, y, a];\n      }\n      return t[0];\n    }\n    function dragstarted(event) {\n      v0 = projection.invert(select(mapRef.current).mouse(event));\n      q0 = geoRotation(projection.rotate());\n    }\n    function dragged(event) {\n      const v1 = projection.invert(select(mapRef.current).mouse(event));\n      const delta = [v1[0] - v0[0], v1[1] - v0[1]];\n      let q1 = q0;\n      if (l > 1) {\n        const p = pointer(event);\n        if (p[2]) {\n          const d = (p[2] - a0) / 2;\n          const s = -Math.sin(d);\n          const c = Math.sign(Math.cos(d));\n          q1 = geoRotationIdentity.rotate([-s * 180 / Math.PI, 0, c * 180 / Math.PI]);\n        }\n      }\n      projection.rotate(geoRotation(q1).invert(delta));\n      if (delta[0] < 0.7) dragstarted(event);\n      render(land110m);\n    }\n    let v0,\n      q0,\n      a0,\n      l = 0;\n    select(context.canvas).call(drag().on(\"start\", dragstarted).on(\"drag\", dragged));\n    render(land50m);\n    return () => {\n      map.remove();\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: mapRef,\n    style: {\n      width: \"800px\",\n      height: \"600px\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 10\n  }, this);\n};\n_s(Globe, \"9mn7MMe4fPaZ50ApsOpRWF2HbFg=\");\n_c = Globe;\nexport default Globe;\nvar _c;\n$RefreshReg$(_c, \"Globe\");","map":{"version":3,"names":["React","useEffect","useRef","L","geoPath","geoNaturalEarth1","select","pointers","drag","geoRotation","geoRotationIdentity","feature","land50mData","land110mData","d3","jsxDEV","_jsxDEV","Globe","_s","mapRef","map","current","setView","tileLayer","addTo","width","height","projection","rotate","fitSize","type","context","getPane","append","attr","node","getContext","path","land50m","objects","land","land110m","render","clearRect","beginPath","fillStyle","fill","stroke","pointer","event","t","length","l","a0","Math","atan2","dragstarted","apply","x","mean","p","y","a","v0","invert","mouse","q0","dragged","v1","delta","q1","d","s","sin","c","sign","cos","PI","canvas","call","on","remove","ref","style","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/vxxiv/task-3/src/graphs/versorDragging.js"],"sourcesContent":["import React, { useEffect, useRef } from \"react\";\r\nimport L from \"leaflet\";\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport { geoPath, geoNaturalEarth1 } from \"d3-geo\";\r\nimport { select, pointers } from \"d3-selection\";\r\nimport { drag } from \"d3-drag\";\r\nimport { geoRotation, geoRotationIdentity } from \"d3-geo-projection\";\r\nimport { feature } from \"topojson-client\";\r\nimport land50mData from \"./land50m.json\";\r\nimport land110mData from \"./land110m.json\";\r\nimport d3 from 'd3-fetch';\r\n\r\n\r\nconst Globe = () => {\r\n  const mapRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const map = L.map(mapRef.current).setView([0, 0], 2);\r\n    L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\").addTo(map);\r\n\r\n    const width = 800;\r\n    const height = 600;\r\n    const projection = geoNaturalEarth1().rotate([0, 0]).fitSize([width, height], { type: \"Sphere\" });\r\n\r\n    const context = select(map.getPane(\"overlayPane\")).append(\"canvas\")\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height)\r\n      .node().getContext(\"2d\");\r\n\r\n    const path = geoPath(projection, context);\r\n\r\n    const land50m = feature(land50mData, land50mData.objects.land);\r\n    const land110m = feature(land110mData, land110mData.objects.land);\r\n\r\n    function render(land) {\r\n      context.clearRect(0, 0, width, height);\r\n      context.beginPath(); path({type: \"Sphere\"}); context.fillStyle = \"#fff\"; context.fill();\r\n      context.beginPath(); path(land); context.fillStyle = \"#000\"; context.fill();\r\n      context.beginPath(); path({type: \"Sphere\"}); context.stroke();\r\n    }\r\n\r\n    function pointer(event) {\r\n      const t = pointers(event);\r\n\r\n      if (t.length !== l) {\r\n        l = t.length;\r\n        if (l > 1) a0 = Math.atan2(t[1][1] - t[0][1], t[1][0] - t[0][0]);\r\n        dragstarted.apply(this, [event]);\r\n      }\r\n\r\n      if (l > 1) {\r\n        const x = d3.mean(t, p => p[0]);\r\n        const y = d3.mean(t, p => p[1]);\r\n        const a = Math.atan2(t[1][1] - t[0][1], t[1][0] - t[0][0]);\r\n        return [x, y, a];\r\n      }\r\n\r\n      return t[0];\r\n    }\r\n\r\n    function dragstarted(event) {\r\n      v0 = projection.invert(select(mapRef.current).mouse(event));\r\n      q0 = geoRotation(projection.rotate());\r\n    }\r\n\r\n    function dragged(event) {\r\n      const v1 = projection.invert(select(mapRef.current).mouse(event));\r\n      const delta = [v1[0] - v0[0], v1[1] - v0[1]];\r\n      let q1 = q0;\r\n\r\n      if (l > 1) {\r\n        const p = pointer(event);\r\n        if (p[2]) {\r\n          const d = (p[2] - a0) / 2;\r\n          const s = -Math.sin(d);\r\n          const c = Math.sign(Math.cos(d));\r\n          q1 = geoRotationIdentity.rotate([-s * 180 / Math.PI, 0, c * 180 / Math.PI]);\r\n        }\r\n      }\r\n\r\n      projection.rotate(geoRotation(q1).invert(delta));\r\n\r\n      if (delta[0] < 0.7) dragstarted(event);\r\n      render(land110m);\r\n    }\r\n\r\n    let v0, q0, a0, l = 0;\r\n    select(context.canvas).call(drag().on(\"start\", dragstarted).on(\"drag\", dragged));\r\n    render(land50m);\r\n\r\n    return () => {\r\n      map.remove();\r\n    };\r\n  }, []);\r\n\r\n  return <div ref={mapRef} style={{ width: \"800px\", height: \"600px\" }} />;\r\n};\r\n\r\nexport default Globe;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}